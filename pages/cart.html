<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>سبد خرید | ماهان شاپ</title>

   <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />

  <link rel="stylesheet" href="../assets/css/style.css" />
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/"
  }
}
</script>
  <style>
    .cart-item {
      position: relative;
      background: #fff;
      border: 1px solid rgba(103, 80, 164, 0.25);
      border-radius: 1.75rem;
      padding: 1.1rem 1.3rem;
      box-shadow: 0 15px 28px rgba(15, 23, 42, 0.08);
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
      content-visibility: auto;
      contain-intrinsic-size: 200px;
    }
    .cart-item:hover:not(.is-updating) {
      transform: translateY(-2px);
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.12);
    }
    .cart-item-details {
      display: flex;
      align-items: center;
      gap: 1rem;
      min-width: 0;
    }
    .cart-item-main {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      width: 100%;
    }
    .cart-item-controls {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      align-items: flex-start;
      width: 100%;
    }
    .cart-item-meta {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.65rem;
      flex-wrap: nowrap;
      width: 100%;
      min-width: 0;
      direction: ltr;
    }
    .cart-actions-row {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      flex-wrap: nowrap;
      width: auto;
    }
    .cart-item-qty {
      display: flex;
      width: 100%;
      justify-content: flex-start;
    }
    .cart-qty-group {
      min-width: 160px;
      gap: 0.35rem;
      background: #f6f2ff;
      padding: 0.2rem 0.25rem;
      border-radius: 999px;
      border: 1px solid rgba(103, 80, 164, 0.25);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8);
      justify-content: center;
    }
    .cart-qty-group button {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: transparent;
      color: #4b3068;
      font-size: 1.35rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: color 0.15s ease, background 0.15s ease;
    }
    .cart-qty-group button:hover {
      color: #391b60;
      background: rgba(103, 80, 164, 0.08);
    }
    .cart-qty-group button:focus-visible {
      outline: none;
      box-shadow: 0 0 0 2px rgba(103, 80, 164, 0.35);
    }
    .cart-qty-group input {
      min-width: 46px;
      border: none;
      background: transparent;
      font-size: 1rem;
      font-weight: 700;
      text-align: center;
      color: #1d162e;
    }
    .cart-qty-group input::-webkit-inner-spin-button,
    .cart-qty-group input::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .cart-price-amount {
      margin-left: auto;
      font-size: 1.15rem;
      letter-spacing: 0.01em;
      white-space: nowrap;
      text-align: right;
    }
    .cart-toast {
      position: fixed;
      left: 1.1rem;
      bottom: 1.1rem;
      background: #1f1b2c;
      color: #fff;
      padding: 0.6rem 1.1rem;
      border-radius: 999px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.35);
      opacity: 0;
      transform: translateY(24px);
      transition: opacity 0.25s ease, transform 0.25s ease;
      font-size: 0.95rem;
      z-index: 70;
      pointer-events: none;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }
    .cart-toast .material-icon {
      font-size: 1.15rem;
      margin-inline-end: 0.25rem;
    }
    .cart-toast.is-visible {
      opacity: 1;
      transform: translateY(0);
    }
    @media (min-width: 640px) {
      .cart-item {
        gap: 1.1rem;
      }
      .cart-item-main {
        flex-direction: row;
        align-items: flex-start;
        justify-content: space-between;
        gap: 1.4rem;
      }
      .cart-item-controls {
        width: auto;
        min-width: 250px;
      }
    }
  </style>
</head>
<body class="bg-[#FEF7FF] text-gray-900 overflow-x-hidden">

  <!-- هدر اصلی: ناوبری، جستجو و وضعیت ورود کاربر -->
  <header id="navbar" class="fixed top-0 z-50 bg-[#FEF7FF]/90 backdrop-blur-md border-b border-gray-200/50 transition-all duration-300">

      <!-- ردیف بالا: لوگو، جستجو و اکشن‌های کاربر -->
      <div id="navbar-top" class="max-w-7xl mx-auto px-4 pt-3 pb-3 md:pb-0">
          <div class="flex flex-wrap md:flex-nowrap items-center justify-between gap-4">

               <!-- بخش چپ: منوی موبایل و لوگو -->
               <div class="flex items-center gap-3 shrink-0">
                   <!-- دکمه باز کردن منو -->
                   <button id="mobile-menu-toggle" type="button" class="md:hidden nav-icon-btn ripple p-2 rounded-full text-gray-700" aria-label="باز کردن منو" aria-controls="mobile-menu" aria-expanded="false">
                       <span class="material-icon" aria-hidden="true">menu</span>
                   </button>

                   <!-- لوگو -->
                   <a href="../index.html" class="flex items-center gap-2 group logo-container">
                       <div class="w-10 h-10 bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl flex items-center justify-center shadow-lg shadow-purple-500/20 group-hover:scale-105 transition-transform duration-300">
                           <span class="material-icon text-white text-xl">shopping_bag</span>
                       </div>
                       <span class="text-xl md:text-2xl font-black text-gray-800 tracking-tight">ماهان شاپ</span>
                   </a>
               </div>

              <!-- جستجو: مسیر و پارامترها توسط بک‌اند تنظیم شوند -->
                  <div class="order-last md:order-none w-full md:max-w-xl mx-auto md:mx-6 transition-all duration-300">
                      <form class="relative group search-container" role="search" action="products.html" method="get">
                          <div class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                          <span class="material-icon text-gray-500 group-focus-within:text-[#6750A4] transition-colors" aria-hidden="true">search</span>
                          </div>
                          <input type="search"
                             name="q"
                             enterkeyhint="search"
                             aria-label="جستجوی محصولات"
                             class="w-full h-12 pr-12 pl-4 rounded-full bg-[#F3EDF7] border border-transparent hover:bg-[#EADDFF]/50 focus:bg-white focus:border-[#6750A4] focus:shadow-[0_4px_12px_rgba(103,80,164,0.15)] outline-none transition-all duration-300 placeholder-gray-500 text-sm md:text-base"
                             placeholder="جستجو در بین هزاران محصول...">
                      </form>
                  </div>

              <!-- اکشن‌های کاربر: علاقه‌مندی، سبد خرید، حساب -->
              <nav class="flex items-center gap-2 md:gap-3 shrink-0" aria-label="ابزارهای کاربری">

                  <!-- علاقه‌مندی‌ها -->
<a href="favorites.html" class="nav-icon-btn ripple w-10 h-10 rounded-lg flex items-center justify-center text-gray-600" title="علاقه‌مندی‌ها" aria-label="علاقه‌مندی‌ها">
                       <span class="material-icon" aria-hidden="true">favorite_border</span>
                   </a>

                  <!-- سبد خرید -->
                  <div id="cart-menu-wrapper" class="relative">
                    <a href="cart.html" id="cart-btn" class="nav-icon-btn ripple w-10 h-10 rounded-lg flex items-center justify-center text-gray-600" title="سبد خرید" aria-label="سبد خرید" aria-haspopup="dialog" aria-controls="cart-menu" aria-expanded="false">
                       <span class="material-icon" aria-hidden="true">shopping_cart</span>
                       <span id="cart-count-badge" class="absolute top-0 right-0 w-4 h-4 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center border border-white hidden z-10" aria-live="polite" aria-atomic="true">0</span>
                    </a>
                    <div id="cart-menu" class="cart-menu" role="dialog" aria-label="سبد خرید" aria-hidden="true" data-cart-menu tabindex="-1">
                      <div class="cart-menu-panel">
                        <div class="cart-menu-header">
                          <div class="flex items-center gap-2">
                            <span class="material-icon text-xl text-[#6750A4]" aria-hidden="true">shopping_cart</span>
                            <div>
                              <h4>سبد خرید</h4>
                              <p class="text-xs text-gray-500" data-cart-menu-status>نمایش خلاصه سفارش</p>
                            </div>
                          </div>
                          <span class="text-xs font-semibold text-[#6750A4]" data-cart-menu-count>۰ کالا</span>
                        </div>
                        <div class="cart-menu-items" data-cart-menu-items>
                          <p class="text-xs text-gray-500 text-center">هنوز کالایی به سبد اضافه نشده است.</p>
                        </div>
                        <div class="cart-menu-footer">
                          <div class="cart-menu-total">
                            <span>جمع</span>
                            <strong data-cart-menu-total>۰ تومان</strong>
                          </div>
                          <div class="cart-menu-actions">
                            <a href="cart.html" class="primary" aria-label="رفتن به صفحه سبد خرید">مشاهده کامل سبد</a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- جداکننده (نمایش در دسکتاپ) -->
                  <div class="hidden md:block w-px h-6 bg-gray-300 mx-1"></div>

                  <!-- وضعیت ورود: بک‌اند مقدار data-auth را روی body تنظیم کند -->
                  <!--
                  <a href="profile.html" class="auth-only hidden md:flex items-center gap-2 pl-1 pr-1 py-1 rounded-full hover:bg-[#F3EDF7] transition-all group profile-section" aria-label="حساب کاربری">
                      <div class="w-8 h-8 bg-[#EADDFF] rounded-full flex items-center justify-center text-[#21005D]">
                          <span class="material-icon text-lg" aria-hidden="true">person</span>
                      </div>
                      <span class="text-sm font-bold text-gray-700 group-hover:text-[#6750A4]">حساب کاربری</span>
                  </a>

                  <a href="profile.html" class="auth-only md:hidden nav-icon-btn ripple w-10 h-10 rounded-full hover:bg-[#F3EDF7] flex items-center justify-center text-gray-600 hover:text-[#6750A4] transition-colors" aria-label="حساب کاربری">
                      <span class="material-icon" aria-hidden="true">person</span>
                  </a>
                  -->

                  <div class="guest-only hidden md:flex header-cta-group">
                      <a href="login.html" class="header-cta header-cta--ghost" aria-label="ورود">
                          <span class="material-icon text-lg" aria-hidden="true">login</span>
                          <span>ورود</span>
                      </a>
                      <a href="register.html" class="header-cta header-cta--primary" aria-label="ثبت نام">
                          <span class="material-icon text-lg" aria-hidden="true">person_add</span>
                          <span>ثبت نام</span>
                      </a>
                  </div>

                  <div class="guest-only md:hidden header-cta-mobile-group">
                      <a href="login.html" class="header-cta-mobile header-cta-mobile--ghost ripple" aria-label="ورود">
                          <span class="material-icon text-lg" aria-hidden="true">login</span>
                          <span class="sr-only">ورود</span>
                      </a>
                      <a href="register.html" class="header-cta-mobile header-cta-mobile--primary ripple" aria-label="ثبت نام">
                          <span class="material-icon text-lg" aria-hidden="true">person_add</span>
                          <span class="sr-only">ثبت نام</span>
                      </a>
                  </div>
              </nav>
          </div>
          <!-- ردیف پایین: دسته‌بندی‌ها -->
          <div id="navbar-bottom" class="border-t border-gray-100/80 md:border-none hidden md:block transition-all duration-300">
              <nav class="secondary-nav flex items-center gap-1 md:gap-6 overflow-x-auto no-scrollbar py-2 md:py-3 mask-image-fade" aria-label="دسته‌بندی‌ها">
                  <a href="../index.html" class="secondary-nav-link active" aria-current="page">
                      <span class="material-icon text-lg" aria-hidden="true">home</span>
                      خانه
                  </a>
                  <a href="products.html" class="secondary-nav-link">
                      <span class="material-icon text-lg" aria-hidden="true">apps</span>
                      تمام محصولات
                  </a>
                  <div class="w-px h-4 bg-gray-300 mx-1 shrink-0 hidden md:block"></div>
                  <div class="nav-dropdown" data-nav-dropdown>
                      <button type="button" class="secondary-nav-link nav-dropdown-trigger" aria-expanded="false" aria-controls="dropdown-case" aria-haspopup="true">
                          قاب گوشی
                          <span class="material-icon nav-caret" aria-hidden="true">expand_more</span>
                      </button>
                      <div id="dropdown-case" class="nav-dropdown-panel" aria-hidden="true">
                          <div class="nav-dropdown-section">
                              <div class="nav-dropdown-title">جنس قاب</div>
                              <div class="nav-dropdown-links">
                                  <a href="products.html?cat=case&material=silicone" class="nav-dropdown-link">سیلیکونی</a>
                                  <a href="products.html?cat=case&material=leather" class="nav-dropdown-link">چرمی</a>
                                  <a href="products.html?cat=case&material=soft" class="nav-dropdown-link">ژله‌ای</a>
                                  <a href="products.html?cat=case&material=hard" class="nav-dropdown-link">سخت</a>
                                  <a href="products.html?cat=case&material=clear" class="nav-dropdown-link">شفاف</a>
                                  <a href="products.html?cat=case&material=shockproof" class="nav-dropdown-link">ضدضربه</a>
                                  <a href="products.html?cat=case&material=magsafe" class="nav-dropdown-link">مگ‌سیف</a>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="nav-dropdown" data-nav-dropdown>
                      <button type="button" class="secondary-nav-link nav-dropdown-trigger" aria-expanded="false" aria-controls="dropdown-phone" aria-haspopup="true">
                          گوشی هوشمند
                          <span class="material-icon nav-caret" aria-hidden="true">expand_more</span>
                      </button>
                      <div id="dropdown-phone" class="nav-dropdown-panel" aria-hidden="true">
                          <div class="nav-dropdown-section">
                              <div class="nav-dropdown-title">برندها</div>
                              <div class="nav-dropdown-links">
                                  <a href="products.html?cat=phone&brand=apple" class="nav-dropdown-link">اپل</a>
                                  <a href="products.html?cat=phone&brand=samsung" class="nav-dropdown-link">سامسونگ</a>
                                  <a href="products.html?cat=phone&brand=xiaomi" class="nav-dropdown-link">شیائومی</a>
                                  <a href="products.html?cat=phone&brand=honor" class="nav-dropdown-link">آنر</a>
                                  <a href="products.html?cat=phone&brand=huawei" class="nav-dropdown-link">هواوی</a>
                                  <a href="products.html?cat=phone&brand=nokia" class="nav-dropdown-link">نوکیا</a>
                                  <a href="products.html?cat=phone&brand=oneplus" class="nav-dropdown-link">وان پلاس</a>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="nav-dropdown" data-nav-dropdown>
                      <button type="button" class="secondary-nav-link nav-dropdown-trigger" aria-expanded="false" aria-controls="dropdown-charger" aria-haspopup="true">
                          شارژ
                          <span class="material-icon nav-caret" aria-hidden="true">expand_more</span>
                      </button>
                      <div id="dropdown-charger" class="nav-dropdown-panel" aria-hidden="true">
                          <div class="nav-dropdown-section">
                              <div class="nav-dropdown-title">شارژ</div>
                              <div class="nav-dropdown-links">
                                  <a href="products.html?cat=charger&type=adapter" class="nav-dropdown-link">دیواری</a>
                                  <a href="products.html?cat=charger&type=car" class="nav-dropdown-link">فندکی</a>
                                  <a href="products.html?cat=charger&type=wireless" class="nav-dropdown-link">بی‌سیم</a>
                                  <a href="products.html?cat=charger&type=cable&type2=type-c" class="nav-dropdown-link">کابل Type-C</a>
                                  <a href="products.html?cat=charger&type=cable&type2=lightning" class="nav-dropdown-link">کابل لایتنینگ</a>
                                  <a href="products.html?cat=charger&type=cable&type2=micro" class="nav-dropdown-link">کابل Micro-USB</a>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="nav-dropdown" data-nav-dropdown>
                      <button type="button" class="secondary-nav-link nav-dropdown-trigger" aria-expanded="false" aria-controls="dropdown-airpod" aria-haspopup="true">
                          کاور ایرپاد
                          <span class="material-icon nav-caret" aria-hidden="true">expand_more</span>
                      </button>
                      <div id="dropdown-airpod" class="nav-dropdown-panel nav-dropdown-panel-wide nav-dropdown-columns" aria-hidden="true">
                          <div class="nav-dropdown-column">
                              <div class="nav-dropdown-title">سازگار با</div>
                              <div class="nav-dropdown-links">
                                  <a href="products.html?cat=airpod&model=airpods-1-2" class="nav-dropdown-link">ایرپاد ۱ و ۲</a>
                                  <a href="products.html?cat=airpod&model=airpods-3" class="nav-dropdown-link">ایرپاد نسل سوم</a>
                                  <a href="products.html?cat=airpod&model=airpods-pro" class="nav-dropdown-link">ایرپاد پرو</a>
                                  <a href="products.html?cat=airpod&model=airpods-max" class="nav-dropdown-link">ایرپاد مکس</a>
                              </div>
                          </div>
                          <div class="nav-dropdown-column">
                              <div class="nav-dropdown-title">سبک کاور</div>
                              <div class="nav-dropdown-links">
                                  <a href="products.html?cat=airpod&material=silicone" class="nav-dropdown-link">سیلیکونی</a>
                                  <a href="products.html?cat=airpod&material=leather" class="nav-dropdown-link">چرمی</a>
                                  <a href="products.html?cat=airpod&style=clear" class="nav-dropdown-link">شفاف</a>
                                  <a href="products.html?cat=airpod&feature=shockproof" class="nav-dropdown-link">ضدضربه</a>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="nav-dropdown" data-nav-dropdown>
                      <button type="button" class="secondary-nav-link nav-dropdown-trigger" aria-expanded="false" aria-controls="dropdown-glass" aria-haspopup="true">
                          گلس و محافظ
                          <span class="material-icon nav-caret" aria-hidden="true">expand_more</span>
                      </button>
                      <div id="dropdown-glass" class="nav-dropdown-panel nav-dropdown-panel-wide nav-dropdown-columns" aria-hidden="true">
                          <div class="nav-dropdown-column">
                              <div class="nav-dropdown-title">نوع گلس</div>
                              <div class="nav-dropdown-links">
                                  <a href="products.html?cat=glass&type=privacy" class="nav-dropdown-link">پرایوسی</a>
                                  <a href="products.html?cat=glass&type=ceramic" class="nav-dropdown-link">سرامیکی</a>
                                  <a href="products.html?cat=glass&type=full" class="nav-dropdown-link">تمام صفحه</a>
                                  <a href="products.html?cat=glass&type=matte" class="nav-dropdown-link">مات</a>
                              </div>
                          </div>
                          <div class="nav-dropdown-column">
                              <div class="nav-dropdown-title">قابلیت‌ها</div>
                              <div class="nav-dropdown-links">
                                  <a href="products.html?cat=glass&feature=anti-blue" class="nav-dropdown-link">ضد تابش</a>
                                  <a href="products.html?cat=glass&feature=anti-scratch" class="nav-dropdown-link">ضد خش</a>
                                  <a href="products.html?cat=glass&feature=anti-shock" class="nav-dropdown-link">ضد ضربه</a>
                                  <a href="products.html?cat=glass&feature=easy-install" class="nav-dropdown-link">نصب آسان</a>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="nav-dropdown" data-nav-dropdown>
                      <button type="button" class="secondary-nav-link nav-dropdown-trigger" aria-expanded="false" aria-controls="dropdown-gadget" aria-haspopup="true">
                          گجت
                          <span class="material-icon nav-caret" aria-hidden="true">expand_more</span>
                      </button>
                      <div id="dropdown-gadget" class="nav-dropdown-panel nav-dropdown-panel-wide nav-dropdown-columns" aria-hidden="true">
                          <div class="nav-dropdown-column">
                              <div class="nav-dropdown-title">گجت‌های محبوب</div>
                              <div class="nav-dropdown-links">
                                  <a href="products.html?cat=gadget&type=powerbank" class="nav-dropdown-link">پاوربانک</a>
                                  <a href="products.html?cat=gadget&type=holder" class="nav-dropdown-link">هولدر و پایه</a>
                                  <a href="products.html?cat=gadget&type=audio" class="nav-dropdown-link">ایرفون و اسپیکر</a>
                                  <a href="products.html?cat=gadget&type=smart" class="nav-dropdown-link">گجت هوشمند</a>
                              </div>
                          </div>
                          <div class="nav-dropdown-column">
                              <div class="nav-dropdown-title">کاربری</div>
                              <div class="nav-dropdown-links">
                                  <a href="products.html?cat=gadget&type=health" class="nav-dropdown-link">سلامت و فیتنس</a>
                                  <a href="products.html?cat=gadget&type=office" class="nav-dropdown-link">دفتر و میزکار</a>
                                  <a href="products.html?cat=gadget&type=travel" class="nav-dropdown-link">سفر و لوازم همراه</a>
                                  <a href="products.html?cat=gadget&type=home" class="nav-dropdown-link">خانه هوشمند</a>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="w-px h-4 bg-gray-300 mx-1 shrink-0 hidden md:block"></div>
                  <a href="about-us.html#contact" class="secondary-nav-link">
                      <span class="material-icon text-lg" aria-hidden="true">contact_support</span>
                      ارتباط با ما
                  </a>
              </nav>
          </div>
      </div>
  </header>

  <!-- Mobile Menu Drawer -->
  <div class="md:hidden">
      <!-- Overlay -->
      <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/40 z-[99] hidden opacity-0 transition-opacity duration-300"></div>
      <!-- Menu -->
      <div id="mobile-menu" class="fixed right-0 top-0 h-full w-4/5 max-w-[300px] bg-[#FEF7FF] shadow-2xl transform translate-x-full z-[100] transition-transform duration-300">
          <div class="p-5 flex justify-between items-center bg-[#F3EDF7]">
              <div class="flex items-center gap-2">
                  <span class="material-icon text-[#6750A4]">shopping_bag</span>
                  <span class="font-bold text-lg text-[#1D1B20]">منوی اصلی</span>
              </div>
              <button id="close-menu-btn" class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-gray-600 hover:text-red-500 shadow-sm transition-colors">
                  <span class="material-icon text-lg">close</span>
              </button>
          </div>
          <div class="p-4 overflow-y-auto h-[calc(100%-64px)]">
              <nav class="flex flex-col gap-1">
                  <a href="../index.html" class="flex items-center gap-3 p-3 rounded-xl text-[#1D1B20] bg-[#EADDFF] font-bold">
                      <span class="material-icon text-[#21005D]">home</span>
                      <span>خانه</span>
                  </a>
                  <a href="products.html" class="flex items-center gap-3 p-3 rounded-xl text-gray-700 font-medium hover:bg-[#F3EDF7] transition-colors">
                      <span class="material-icon text-gray-500">category</span>
                      <span>همه محصولات</span>
                  </a>
                  <div class="border-t border-gray-200 my-2 mx-2"></div>
                  <span class="text-xs font-bold text-gray-400 px-3 mb-1">دسته‌بندی‌ها</span>
                  <a href="products.html?cat=case" class="flex items-center gap-3 p-3 rounded-xl text-gray-600 font-medium hover:bg-[#F3EDF7] hover:text-[#6750A4] transition-colors">
                      <span class="material-icon text-lg">smartphone</span> قاب گوشی
                  </a>
                  <a href="products.html?cat=phone" class="flex items-center gap-3 p-3 rounded-xl text-gray-600 font-medium hover:bg-[#F3EDF7] hover:text-[#6750A4] transition-colors">
                      <span class="material-icon text-lg">headphones</span> کاور ایرپاد
                  </a>
                  <a href="products.html?cat=charger" class="flex items-center gap-3 p-3 rounded-xl text-gray-600 font-medium hover:bg-[#F3EDF7] hover:text-[#6750A4] transition-colors">
                      <span class="material-icon text-lg">bolt</span> شارژ
                  </a>
                  <div class="border-t border-gray-200 my-2 mx-2"></div>
                  <a href="profile.html" class="flex items-center gap-3 p-3 rounded-xl text-gray-700 font-medium hover:bg-[#F3EDF7] transition-colors">
                      <span class="material-icon">person</span>
                      <span>حساب کاربری</span>
                  </a>
                  <a href="about-us.html" class="flex items-center gap-3 p-3 rounded-xl text-gray-700 font-medium hover:bg-[#F3EDF7] transition-colors">
                      <span class="material-icon">info</span>
                      <span>درباره ما</span>
                  </a>
                  <a href="about-us.html#contact" class="flex items-center gap-3 p-3 rounded-xl text-gray-700 font-medium hover:bg-[#F3EDF7] transition-colors">
                      <span class="material-icon">contact_support</span>
                      <span>ارتباط با ما</span>
                  </a>
              </nav>
          </div>
      </div>
  </div>

  <main class="relative max-w-7xl mx-auto px-4 py-6 md:py-10">
    <div class="pointer-events-none absolute inset-0 -z-10">
      <div class="absolute -top-16 right-0 w-72 h-72 bg-gradient-to-br from-[#EAD9FF] via-[#F8F4FF] to-transparent blur-3xl opacity-80"></div>
      <div class="absolute -bottom-20 left-0 w-80 h-80 bg-gradient-to-tr from-[#DFF3FF] via-[#F8FBFF] to-transparent blur-3xl opacity-70"></div>
    </div>

    <div class="flex flex-col gap-3 mb-6">
      <p class="text-xs uppercase tracking-[0.35em] text-gray-400">یک قدم تا تکمیل سفارش</p>
      <h1 class="text-3xl md:text-4xl font-black text-gray-900">سبد خرید شما</h1>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-[1.65fr_0.75fr] gap-12 items-start" data-cart-main data-cart-empty="false">
      <section class="space-y-8">
        <div class="flex flex-wrap items-end justify-between gap-4 border-b border-gray-200/70 pb-6">
          <div></div>
        </div>

      <div id="cart-items-wrapper" class="flex flex-col gap-4 rounded-3xl bg-transparent px-3 py-3 max-h-[65vh] overflow-y-auto">
          <article class="cart-item" data-cart-item="case-iphone-15-silicone" data-unit-price="450000">
            <div class="cart-item-main">
              <div class="cart-item-details">
                <img src="https://placehold.co/100x100" alt="قاب سیلیکونی آیفون ۱۵" class="w-20 h-20 rounded-2xl object-cover">
                <div class="flex flex-col gap-2">
                  <h2 class="text-lg font-extrabold text-gray-900">قاب سیلیکونی آیفون ۱۵</h2>
                  <p class="text-sm text-gray-500">برند: Apple</p>
                </div>
              </div>
              <div class="cart-item-controls">
                <div class="cart-item-meta">
                  <div class="cart-actions-row">
                    <button class="text-sm font-semibold text-red-600 bg-white border border-red-100 hover:bg-red-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-400 transition flex items-center gap-1 px-3 py-1.5 rounded-full shadow-sm shadow-red-50" type="button" aria-label="حذف از سبد خرید" data-action="remove-cart-item">
                      <span class="material-icon text-sm">delete</span>
                      حذف
                    </button>
                  </div>
                  <div class="cart-price-amount text-[#6750A4] font-black" data-item-total>۴۵۰,۰۰۰ تومان</div>
                </div>
                <div class="cart-item-qty">
                  <div class="cart-qty-group flex items-center justify-center">
                    <button class="qty-minus" type="button" aria-label="کاهش تعداد">
                      -
                    </button>
                    <input type="text" value="1" class="border-none bg-transparent font-bold focus:outline-none" readonly>
                    <button class="qty-plus" type="button" aria-label="افزایش تعداد">
                      +
                    </button>
                  </div>
                </div>
              </div>

            </div>
          </article>

          <article class="cart-item" data-cart-item="anker-charge-usb-cable" data-unit-price="350000">
            <div class="cart-item-main">
              <div class="cart-item-details">
                <img src="https://placehold.co/100x100" alt="کابل شارژ انکر" class="w-20 h-20 rounded-2xl object-cover">
                <div class="flex flex-col gap-2">
                  <h2 class="text-lg font-extrabold text-gray-900">کابل شارژ انکر</h2>
                  <p class="text-sm text-gray-500">برند: Anker</p>
                </div>
              </div>
              <div class="cart-item-controls">
                <div class="cart-item-meta">
                  <div class="cart-actions-row">
                    <button class="text-sm font-semibold text-red-600 bg-white border border-red-100 hover:bg-red-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-400 transition flex items-center gap-1 px-3 py-1.5 rounded-full shadow-sm shadow-red-50" type="button" aria-label="حذف از سبد خرید" data-action="remove-cart-item">
                      <span class="material-icon text-sm">delete</span>
                      حذف
                    </button>
                  </div>
                  <div class="cart-price-amount text-[#1D1B20] font-black" data-item-total>۳۵۰,۰۰۰ تومان</div>
                </div>
                <div class="cart-item-qty">
                  <div class="cart-qty-group flex items-center justify-center">
                    <button class="qty-minus" type="button" aria-label="کاهش تعداد">
                      -
                    </button>
                    <input type="text" value="2" class="border-none bg-transparent font-bold focus:outline-none" readonly>
                    <button class="qty-plus" type="button" aria-label="افزایش تعداد">
                      +
                    </button>
                  </div>
                </div>
              </div>
          </article>
        </div>

        <div id="cart-empty-state" class="hidden rounded-3xl bg-white/80 backdrop-blur-sm shadow-[0_18px_45px_rgba(103,80,164,0.1)] px-6 py-10 text-center text-gray-500 space-y-3">
          <span class="material-icon text-4xl text-[#A855F7]">shopping_bag</span>
          <p class="text-lg font-bold text-gray-900">سبد خرید شما خالی است</p>
          <p class="text-sm">برای شروع، وارد فروشگاه شوید و بهترین لوازم جانبی را انتخاب کنید.</p>
          <a href="../index.html" class="inline-flex items-center justify-center gap-2 text-sm font-semibold text-[#6750A4] hover:text-[#4c2f91] transition">
            <span class="material-icon text-base">arrow_forward</span>
            برگشت به فروشگاه
          </a>
        </div>
        <!-- این بلوک فقط زمانی فعال شود که سبد واقعا خالی باشد -->
      </section>

      <div id="cart-confirm-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div data-confirm-overlay class="absolute inset-0 bg-black/40"></div>
        <div class="relative w-full max-w-sm rounded-3xl bg-white p-6 text-center shadow-[0_20px_60px_rgba(15,23,42,0.3)]">
          <span class="material-icon text-4xl text-red-500 block mb-3">warning</span>
          <p class="text-lg font-bold text-gray-900 mb-1">حذف محصول از سبد</p>
          <p class="text-sm text-gray-500 mb-4">آیا مطمئن هستید که می‌خواهید این کالا را از سبد حذف کنید؟</p>
          <div class="flex items-center justify-center gap-3">
            <button data-confirm-cancel class="px-4 py-2 rounded-full border border-gray-200 text-gray-700 text-sm font-semibold hover:bg-gray-100 transition">خیر</button>
            <button data-confirm-ok class="px-4 py-2 rounded-full bg-red-600 text-white text-sm font-semibold hover:bg-red-700 transition flex items-center gap-2 justify-center">
              <span class="material-icon text-base">delete</span>
              حذف کنم
            </button>
          </div>
        </div>
      </div>

      <section class="space-y-6 lg:pr-10 lg:border-r lg:border-gray-200/70">
        <div class="sticky top-0 space-y-6">
          <div class="rounded-3xl bg-white/80 backdrop-blur-sm shadow-[0_20px_50px_rgba(103,80,164,0.12)] p-6 space-y-4">
            <h2 class="text-xl font-bold text-gray-900">خلاصه سبد خرید</h2>
            <div class="space-y-3 text-sm text-gray-700">
              <div class="flex justify-between items-center">
                <span>جمع کل</span>
                <strong data-cart-subtotal class="text-[#6750A4] font-black">۱,۱۵۰,۰۰۰ تومان</strong>
              </div>
              <div class="flex justify-between items-center" data-cart-shipping-row data-shipping-value="0">
                <span>هزینه ارسال</span>
                <span data-cart-shipping-text>رایگان</span>
              </div>
              <div class="flex justify-between items-center border-t border-gray-200/70 pt-3 font-black text-lg">
                <span>قابل پرداخت</span>
                <strong class="text-[#6750A4]" data-cart-grandtotal>۱,۱۵۰,۰۰۰ تومان</strong>
              </div>
            </div>
          </div>
          <div class="space-y-3">
            <button class="w-full bg-[#6750A4] text-white font-bold py-3.5 rounded-full hover:bg-[#523e85] transition-colors shadow-lg shadow-[#6750A4]/20 flex items-center justify-center gap-2 ripple">
              ادامه و ثبت سفارش
              <span class="material-icon text-sm">shopping_bag</span>
            </button>
            <a href="../index.html" class="block text-center text-sm text-gray-500 hover:text-gray-800">بازگشت به فروشگاه</a>
          </div>
        </div>

        <div class="rounded-3xl bg-[#F7F2FA] px-6 py-5 shadow-[0_18px_40px_rgba(103,80,164,0.08)] space-y-4" data-address-card data-address-added="false">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs uppercase tracking-[0.3em] text-gray-400">آدرس ارسال</p>
              <h3 class="text-lg font-semibold text-gray-900">آدرسی ثبت نشده است</h3>
            </div>
            <span class="text-sm font-bold text-red-500">نیاز به اتمام</span>
          </div>
          <div data-address-empty class="space-y-2 text-sm text-gray-600">
            <p>در حال حاضر هیچ آدرسی به سبد متصل نیست.</p>
            <div class="flex items-start gap-2 border-r-2 border-red-300 pr-3 text-red-600 text-xs font-semibold">
              <span class="material-icon text-base">warning</span>
              برای ثبت سفارش باید یک آدرس در صفحه پروفایل اضافه کنید.
            </div>
            <a href="profile.html#details?addAddress=1" class="inline-flex items-center gap-2 text-sm font-semibold text-[#6750A4] hover:text-[#4c2f91] transition">
              رفتن به ثبت آدرس
              <span class="material-icon text-base">arrow_forward</span>
            </a>
          </div>
          <div data-address-filled class="hidden space-y-1 text-sm text-gray-600">
            <p class="text-gray-500">آدرس پیش‌فرض</p>
            <p class="font-semibold text-gray-900 leading-tight">تهران، خیابان ولیعصر، پلاک ۲۳، واحد ۴</p>
            <p class="text-gray-500">محمد رضایی · ۰۹۱۲۱۲۳۴۵۶۷</p>
          </div>
          <!-- اگر آدرسی ثبت شود، حالت دوم نمایش پیدا می‌کند -->
        </div>
      </section>
    </div>
  </main>

  <!-- Cart anchor (for footer cart link) -->
  <div id="cart" aria-hidden="true"></div>

  <footer id="footer" class="bg-white border-t border-gray-100 pt-16 pb-8 relative overflow-hidden">
      <!-- Background decorations -->
      <div class="absolute inset-0 opacity-40 pointer-events-none">
        <div class="absolute top-0 right-0 w-96 h-96 bg-purple-100 rounded-full filter blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-96 h-96 bg-blue-100 rounded-full filter blur-3xl"></div>
      </div>

      <div class="relative max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-12 mb-12">

          <!-- Brand Section - Mobile & Desktop -->
          <div class="lg:col-span-1">
            <div class="flex items-center gap-3 mb-4 lg:mb-6">
              <div class="w-10 h-10 lg:w-12 lg:h-12 bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl lg:rounded-2xl flex items-center justify-center shadow-lg">
                <span class="material-icon text-white text-lg lg:text-2xl">shopping_bag</span>
              </div>
              <h3 class="text-xl lg:text-2xl font-bold text-gray-900">ماهان شاپ</h3>
            </div>

            <p class="text-gray-600 text-sm lg:text-base leading-relaxed mb-4 lg:mb-6">
              مرجع تخصصی لوازم جانبی موبایل با بهترین کیفیت و قیمت مناسب.
            </p>
            <div class="flex gap-2 lg:gap-3">
              <a href="#" class="w-8 h-8 lg:w-10 lg:h-10 bg-gray-100 rounded-lg lg:rounded-xl flex items-center justify-center text-gray-600 hover:bg-gradient-to-br hover:from-purple-500 hover:to-purple-600 hover:text-white hover:scale-110 hover:shadow-lg hover:shadow-purple-500/30 transition-all duration-300 ripple">
                <span class="material-icon text-sm lg:text-lg">send</span>
              </a>
              <a href="#" class="w-8 h-8 lg:w-10 lg:h-10 bg-gray-100 rounded-lg lg:rounded-xl flex items-center justify-center text-gray-600 hover:bg-gradient-to-br hover:from-pink-500 hover:to-rose-500 hover:text-white hover:scale-110 hover:shadow-lg hover:shadow-pink-500/30 transition-all duration-300 ripple">
                <span class="material-icon text-sm lg:text-lg">photo_camera</span>
              </a>
              <a href="#" class="w-8 h-8 lg:w-10 lg:h-10 bg-gray-100 rounded-lg lg:rounded-xl flex items-center justify-center text-gray-600 hover:bg-gradient-to-br hover:from-blue-500 hover:to-cyan-500 hover:text-white hover:scale-110 hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-300 ripple">
                <span class="material-icon text-sm lg:text-lg">public</span>
              </a>
            </div>
          </div>

          <!-- Quick Links - Mobile & Desktop -->
          <div class="lg:col-span-1">
            <h4 class="text-base lg:text-lg font-semibold text-gray-900 mb-3 lg:mb-6">دسترسی سریع</h4>

            <!-- Mobile Layout: Horizontal -->
            <div class="lg:hidden">
              <div class="flex flex-wrap gap-x-3 gap-y-2 text-sm">
                <a href="products.html?cat=case" class="text-gray-600 hover:text-purple-600 transition-colors">قاب گوشی</a>
                <a href="products.html?cat=phone" class="text-gray-600 hover:text-purple-600 transition-colors">گوشی</a>
                <a href="products.html?cat=charger" class="text-gray-600 hover:text-purple-600 transition-colors">شارژر</a>
                <a href="products.html?cat=airpod" class="text-gray-600 hover:text-purple-600 transition-colors">ایرپاد</a>
                <a href="products.html?cat=glass" class="text-gray-600 hover:text-purple-600 transition-colors">گلس</a>
                <a href="products.html?cat=gadget" class="text-gray-600 hover:text-purple-600 transition-colors">گجت</a>
              </div>
            </div>

            <!-- Desktop Layout: Vertical -->
            <div class="hidden lg:block">
              <ul class="space-y-4">
                <li><a href="products.html?cat=case" class="text-gray-600 hover:text-purple-600 transition-colors">قاب گوشی</a></li>
                <li><a href="products.html?cat=phone" class="text-gray-600 hover:text-purple-600 transition-colors">گوشی هوشمند</a></li>
                <li><a href="products.html?cat=charger" class="text-gray-600 hover:text-purple-600 transition-colors">شارژ</a></li>
                <li><a href="products.html?cat=airpod" class="text-gray-600 hover:text-purple-600 transition-colors">کاور ایرپاد</a></li>
                <li><a href="products.html?cat=glass" class="text-gray-600 hover:text-purple-600 transition-colors">گلس و محافظ</a></li>
                <li><a href="products.html?cat=gadget" class="text-gray-600 hover:text-purple-600 transition-colors">گجت</a></li>
              </ul>
            </div>
          </div>

          <!-- Customer Service - Mobile & Desktop -->
          <div class="lg:col-span-1">
            <h4 class="text-base lg:text-lg font-semibold text-gray-900 mb-3 lg:mb-6">خدمات مشتریان</h4>

            <!-- Mobile Layout: Horizontal -->
            <div class="lg:hidden">
              <div class="flex flex-wrap gap-x-3 gap-y-2 text-sm">
                <a href="about-us.html#faq" class="text-gray-600 hover:text-purple-600 transition-colors">سوالات متداول</a>
                <a href="about-us.html#returns" class="text-gray-600 hover:text-purple-600 transition-colors">بازگشت کالا</a>
                <a href="about-us.html#shipping" class="text-gray-600 hover:text-purple-600 transition-colors">ارسال</a>
                <a href="about-us.html#payment" class="text-gray-600 hover:text-purple-600 transition-colors">پرداخت</a>
                <a href="profile.html" class="text-gray-600 hover:text-purple-600 transition-colors">پروفایل</a>
                <a href="about-us.html" class="text-gray-600 hover:text-purple-600 transition-colors">درباره ما</a>
                <a href="about-us.html#contact" class="text-gray-600 hover:text-purple-600 transition-colors">تماس</a>
              </div>
            </div>

            <!-- Desktop Layout: Vertical -->
            <div class="hidden lg:block">
              <ul class="space-y-4">
                <li><a href="about-us.html#faq" class="text-gray-600 hover:text-purple-600 transition-colors">سوالات متداول</a></li>
                <li><a href="about-us.html#returns" class="text-gray-600 hover:text-purple-600 transition-colors">بازگشت کالا</a></li>
                <li><a href="about-us.html#shipping" class="text-gray-600 hover:text-purple-600 transition-colors">روش‌های ارسال</a></li>
                <li><a href="about-us.html#payment" class="text-gray-600 hover:text-purple-600 transition-colors">روش‌های پرداخت</a></li>
                <li><a href="profile.html" class="text-gray-600 hover:text-purple-600 transition-colors">پروفایل کاربری</a></li>
                <li><a href="about-us.html" class="text-gray-600 hover:text-purple-600 transition-colors">درباره ما</a></li>
                <li><a href="about-us.html#contact" class="text-gray-600 hover:text-purple-600 transition-colors">تماس با پشتیبانی</a></li>
              </ul>
            </div>
          </div>

          <!-- Contact Section - Mobile & Desktop -->
          <div class="lg:col-span-1">
            <h4 class="text-base lg:text-lg font-semibold text-gray-900 mb-3 lg:mb-6">اطلاعات تماس</h4>

            <div class="space-y-3 lg:space-y-4">
              <div class="flex items-center gap-2 lg:gap-3 text-gray-600">
                <span class="material-icon text-purple-600 text-sm lg:text-base">call</span>
                <a href="tel:09121234567" class="text-sm lg:text-base hover:text-purple-600">۰۹۱۲۱۲۳۴۵۶۷</a>
              </div>
              <div class="flex items-center gap-2 lg:gap-3 text-gray-600">
                <span class="material-icon text-purple-600 text-sm lg:text-base">schedule</span>
                <span class="text-sm lg:text-base">هر روز ۱۰:۰۰ - ۲۲:۰۰</span>
              </div>
              <div class="flex items-center gap-2 lg:gap-3 text-gray-600">
                <span class="material-icon text-purple-600 text-sm lg:text-base">email</span>
                <a href="mailto:info@mahanshop.com" class="text-sm lg:text-base hover:text-purple-600">info@mahanshop.com</a>
              </div>
              <div class="hidden lg:flex items-center gap-3 text-gray-600">
                <span class="material-icon text-purple-600">location_on</span>
                <span class="text-sm">تهران، خیابان ولیعصر</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom Footer -->
        <div class="border-t border-gray-200 pt-8">
          <div class="flex flex-col-reverse sm:flex-row items-center justify-between gap-4 text-center">
            <p class="text-gray-500 text-sm">© ۱۴۰۳ ماهان شاپ. تمامی حقوق محفوظ است.</p>
            <div class="flex flex-wrap justify-center gap-4 sm:gap-6">
              <a href="#top" class="text-gray-500 hover:text-purple-600 text-sm transition-colors flex items-center gap-1">
                <span>بازگشت به بالا</span>
                <span class="material-icon text-base">arrow_upward</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </footer>



  <div id="cart-toast" class="cart-toast" role="status" aria-live="polite" aria-atomic="true"></div>
  <script defer src="../assets/js/script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const cartMain = document.querySelector('[data-cart-main]');
      const itemWrapper = document.getElementById('cart-items-wrapper');
      const emptyState = document.getElementById('cart-empty-state');
      if (cartMain && itemWrapper && emptyState) {
        const isEmpty = cartMain.dataset.cartEmpty === 'true';
        itemWrapper.classList.toggle('hidden', isEmpty);
        emptyState.classList.toggle('hidden', !isEmpty);
      }

      const addressCard = document.querySelector('[data-address-card]');
      if (addressCard) {
        const hasAddress = addressCard.dataset.addressAdded === 'true';
        const emptyNotice = addressCard.querySelector('[data-address-empty]');
        const filledNotice = addressCard.querySelector('[data-address-filled]');
        if (emptyNotice && filledNotice) {
          emptyNotice.classList.toggle('hidden', hasAddress);
          filledNotice.classList.toggle('hidden', !hasAddress);
        }
      }

      initCartAjax();
    });

    function initCartAjax() {
      const cartWrapper = document.getElementById('cart-items-wrapper');
      if (!cartWrapper) return;
      const cartMain = document.querySelector('[data-cart-main]');
      const emptyState = document.getElementById('cart-empty-state');
      const subtotalEl = document.querySelector('[data-cart-subtotal]');
      const grandtotalEl = document.querySelector('[data-cart-grandtotal]');
      const shippingRow = document.querySelector('[data-cart-shipping-row]');
      const shippingValue = Number(shippingRow?.dataset?.shippingValue ?? '0') || 0;
      const currencyFormatter = new Intl.NumberFormat('fa-IR');
      const confirmModal = document.getElementById('cart-confirm-modal');
      const confirmOverlay = confirmModal?.querySelector('[data-confirm-overlay]');
      const confirmOk = confirmModal?.querySelector('[data-confirm-ok]');
      const confirmCancel = confirmModal?.querySelector('[data-confirm-cancel]');
      const toastEl = document.getElementById('cart-toast');
      let toastTimeoutId = null;
      let pendingRemoval = null;

      const closeConfirmModal = () => {
        if (!confirmModal) return;
        confirmModal.classList.add('hidden');
        pendingRemoval = null;
        document.body.classList.remove('overflow-hidden');
      };

      const openConfirmModal = (article) => {
        if (!confirmModal || !article) {
          handleRemove(article);
          return;
        }
        pendingRemoval = article;
        confirmModal.classList.remove('hidden');
        document.body.classList.add('overflow-hidden');
      };

      confirmOverlay?.addEventListener('click', () => closeConfirmModal());
      confirmCancel?.addEventListener('click', () => closeConfirmModal());
      confirmOk?.addEventListener('click', () => {
        if (!pendingRemoval) {
          closeConfirmModal();
          return;
        }
        handleRemove(pendingRemoval);
        closeConfirmModal();
      });
      document.addEventListener('keydown', (event) => {
        if (!pendingRemoval) return;
        if (event.key === 'Escape') {
          event.preventDefault();
          closeConfirmModal();
        }
      });

      const formatCurrency = (value) => `${currencyFormatter.format(Math.round(value))} تومان`;
      const parseQty = (input) => Math.max(1, parseInt(input?.value ?? '1', 10) || 1);
      const getItems = () => Array.from(cartWrapper.querySelectorAll('[data-cart-item]'));

      const updateVisibility = () => {
        const hasItems = getItems().length > 0;
        cartWrapper.classList.toggle('hidden', !hasItems);
        if (emptyState) emptyState.classList.toggle('hidden', hasItems);
        if (cartMain) cartMain.dataset.cartEmpty = hasItems ? 'false' : 'true';
      };

      const recalcSummary = () => {
        const subtotal = getItems().reduce((sum, article) => {
          const unitPrice = Number(article.dataset.unitPrice ?? '0') || 0;
          const qtyInput = article.querySelector('input[type="text"]');
          const qty = parseQty(qtyInput);
          return sum + unitPrice * qty;
        }, 0);
        if (subtotalEl) subtotalEl.textContent = formatCurrency(subtotal);
        if (grandtotalEl) grandtotalEl.textContent = formatCurrency(subtotal + shippingValue);
      };

      const toggleItemLoading = (article, isLoading) => {
        if (!article) return;
        article.classList.toggle('is-updating', isLoading);
        article.setAttribute('aria-busy', isLoading ? 'true' : 'false');
        article.querySelectorAll('button, input').forEach((control) => {
          control.disabled = isLoading;
        });
      };

      const simulateAjax = () => new Promise((resolve) => {
        const delay = 220 + Math.random() * 180;
        setTimeout(resolve, delay);
      });

      const showToast = (message) => {
        if (!toastEl || !message) return;
        toastEl.textContent = message;
        toastEl.classList.add('is-visible');
        if (toastTimeoutId) clearTimeout(toastTimeoutId);
        toastTimeoutId = setTimeout(() => {
          toastEl.classList.remove('is-visible');
        }, 2800);
      };

      const updateItemVisuals = (article, quantity) => {
        if (!article) return;
        const qtyInput = article.querySelector('input[type="text"]');
        const totalEl = article.querySelector('[data-item-total]');
        const unitPrice = Number(article.dataset.unitPrice ?? '0') || 0;
        const qty = Math.max(1, quantity);
        if (qtyInput) qtyInput.value = qty;
        if (totalEl) totalEl.textContent = formatCurrency(unitPrice * qty);
      };

      const handleQtyChange = async (article, delta) => {
        if (!article) return;
        const qtyInput = article.querySelector('input[type="text"]');
        const currentQty = parseQty(qtyInput);
        const nextQty = Math.max(1, currentQty + delta);
        if (nextQty === currentQty) return;
        toggleItemLoading(article, true);
        try {
          await simulateAjax();
          updateItemVisuals(article, nextQty);
          recalcSummary();
        } finally {
          toggleItemLoading(article, false);
        }
      };

      const handleRemove = async (article, successMessage = 'کالا از سبد حذف شد') => {
        if (!article) return;
        toggleItemLoading(article, true);
        try {
          await simulateAjax();
          article.remove();
        } finally {
          toggleItemLoading(article, false);
        }
        recalcSummary();
        updateVisibility();
        showToast(successMessage);
      };

      cartWrapper.addEventListener('click', (event) => {
        const plusBtn = event.target.closest('.qty-plus');
        const minusBtn = event.target.closest('.qty-minus');
        const removeBtn = event.target.closest('[data-action="remove-cart-item"]');
        if (!plusBtn && !minusBtn && !removeBtn) return;
        event.preventDefault();
        const trigger = plusBtn || minusBtn || removeBtn;
        const article = trigger?.closest('[data-cart-item]');
        if (!article || article.classList.contains('is-updating')) return;
        if (removeBtn) {
          openConfirmModal(article);
          return;
        }
        if (plusBtn) {
          handleQtyChange(article, 1);
        } else if (minusBtn) {
          handleQtyChange(article, -1);
        }
      });

      updateVisibility();
      recalcSummary();
    }
  </script>
</body>
</html>
